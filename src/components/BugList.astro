---
import bugList from '@/assets/bug_buckets/bug_buckets.json';
import Bug from './Bug.astro';
import { type RESTlerBug } from '@/types/types';
import fs from 'fs';
import path from 'path';

// Load all bug data
const bugs: RESTlerBug[] = [];

for (const [bugId, bugInfo] of Object.entries(bugList)) {
    // Convert replay file path to corresponding JSON file name
    // e.g., "PayloadBodyChecker_500_1.replay.txt" -> "PayloadBodyChecker_500_1.json"
    const jsonFileName = bugInfo.file_path.replace('.replay.txt', '.json');
    
    // Build absolute path from current directory (src/components for dev mode, dist for production) to the JSON file in the bug_buckets directory
    const filePath = path.join(process.cwd(), 'src/assets/bug_buckets', jsonFileName);
    
    try {
        if (fs.existsSync(filePath)) {
            const fileContent = fs.readFileSync(filePath, 'utf-8');
            const bugData = JSON.parse(fileContent);
            bugs.push({ ...bugData, bug_id: bugId });
        } else {
            console.warn(`Bug data file not found: ${jsonFileName}`);
        }
    } catch (error) {
        console.error(`Failed to load bug data for ${bugId}:`, error);
    }
}

console.log(`Successfully loaded ${bugs.length} bugs`);
---

<div class="bug-list">
    <h2>RESTler Bug Report ({bugs.length} bugs found)</h2>
    <div class="bugs-container">
        {bugs.map((bug) => (
            <Bug bug={bug} />
        ))}
    </div>
</div>

<style>
    .bug-list {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }
    
    .bugs-container {
        display: grid;
        gap: 20px;
        grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
    }
    
    h2 {
        color: #333;
        border-bottom: 2px solid #007acc;
        padding-bottom: 10px;
        margin-bottom: 20px;
    }
</style>